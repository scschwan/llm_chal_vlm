<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶ˆëŸ‰ ë¶„ì„ ì‹œìŠ¤í…œ (RAG)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .nav {
            background: #f8f9fa;
            padding: 15px 30px;
            border-bottom: 2px solid #dee2e6;
            display: flex;
            gap: 10px;
        }
        .nav-btn {
            padding: 10px 20px;
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        .nav-btn:hover { background: #667eea; color: white; }
        .nav-btn.active { background: #667eea; color: white; }
        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            padding: 30px;
        }
        .upload-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
        }
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
            margin-bottom: 20px;
        }
        .upload-area:hover { border-color: #764ba2; background: #f8f9ff; }
        .upload-icon { font-size: 4em; margin-bottom: 15px; }
        #fileInput { display: none; }
        .preview-image {
            width: 100%;
            border-radius: 10px;
            margin-top: 10px;
            display: none;
            max-height: 300px;
            object-fit: cover;
        }
        .analyze-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            margin-top: 20px;
        }
        .analyze-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .analyze-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .results-section { min-height: 500px; }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 0 20px;
        }
        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: #dee2e6;
            z-index: -1;
        }
        .step:last-child::after { display: none; }
        .step-circle {
            width: 40px;
            height: 40px;
            background: #dee2e6;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #6c757d;
            margin-bottom: 8px;
        }
        .step.active .step-circle {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .step.completed .step-circle {
            background: #28a745;
            color: white;
        }
        .step-label {
            font-size: 0.9em;
            color: #6c757d;
            font-weight: 600;
        }
        .result-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .result-title {
            font-size: 1.5em;
            color: #343a40;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .similar-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        .similar-image-card {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s;
            cursor: pointer;
        }
        .similar-image-card:hover {
            border-color: #667eea;
            transform: translateY(-3px);
        }
        .similar-image-card.selected {
            border-color: #28a745;
            border-width: 3px;
        }
        .similar-image-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        .similar-image-info {
            padding: 10px;
            background: #f8f9fa;
        }
        .similarity-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 700;
        }
        .terminal-log {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .log-line {
            margin-bottom: 5px;
            line-height: 1.5;
        }
        .log-timestamp {
            color: #858585;
            margin-right: 10px;
        }
        .log-level {
            font-weight: 700;
            margin-right: 10px;
        }
        .log-level.info { color: #4ec9b0; }
        .log-level.success { color: #b5cea8; }
        .log-level.warning { color: #dcdcaa; }
        .log-level.error { color: #f48771; }
        .analysis-result {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            margin-top: 15px;
        }
        .analysis-result h4 {
            color: #343a40;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .analysis-content {
            line-height: 1.8;
            color: #495057;
        }
        .defect-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }
        .defect-tag {
            display: inline-block;
            padding: 6px 12px;
            background: #ffc107;
            color: #000;
            border-radius: 5px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .action-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
        }
        .action-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
        }
        .action-list li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: #28a745;
            font-weight: 700;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-weight: 600;
            display: none;
        }
        .status-message.success { background: #d4edda; color: #155724; }
        .status-message.info { background: #d1ecf1; color: #0c5460; }
        .status-message.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”¬ ë¶ˆëŸ‰ ë¶„ì„ ì‹œìŠ¤í…œ (RAG)</h1>
            <p>AI ê¸°ë°˜ ìë™ ë¶ˆëŸ‰ ë¶„ì„ ë° ëŒ€ì‘ ë§¤ë‰´ì–¼ ìƒì„±</p>
        </div>

        <div class="nav">
            <a href="matching.html" class="nav-btn">ìœ ì‚¬ì´ë¯¸ì§€ ë§¤ì¹­</a>
            <a href="manual_mapping.html" class="nav-btn">ë°ì´í„°ì…‹ ë§¤í•‘</a>
            <a href="defect_analysis.html" class="nav-btn active">ë¶ˆëŸ‰ ë¶„ì„ (RAG)</a>
            <a href="dashboard.html" class="nav-btn">í†µê³„ ëŒ€ì‹œë³´ë“œ</a>
        </div>

        <div class="main-content">
            <!-- ì¢Œì¸¡: ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
            <div class="upload-section">
                <h3 style="margin-bottom: 15px; color: #343a40;">ë¶ˆëŸ‰ ì´ë¯¸ì§€ ì—…ë¡œë“œ</h3>
                
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ”</div>
                    <p style="font-size: 1.1em; color: #495057; margin-bottom: 10px;">
                        <strong>í´ë¦­</strong>í•˜ê±°ë‚˜ <strong>ë“œë˜ê·¸</strong>í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ
                    </p>
                    <p style="font-size: 0.9em; color: #6c757d;">
                        JPG, PNG ì§€ì›
                    </p>
                    <input type="file" id="fileInput" accept="image/*">
                </div>

                <img id="previewImage" class="preview-image" alt="Preview">

                <button class="analyze-button" id="analyzeButton" disabled>
                    ğŸš€ ë¶ˆëŸ‰ ë¶„ì„ ì‹œì‘
                </button>

                <div id="statusMessage" class="status-message"></div>
            </div>

            <!-- ìš°ì¸¡: ë¶„ì„ ê²°ê³¼ -->
            <div class="results-section">
                <!-- ë‹¨ê³„ í‘œì‹œ -->
                <div class="step-indicator">
                    <div class="step" id="step1">
                        <div class="step-circle">1</div>
                        <div class="step-label">ìœ ì‚¬ì´ë¯¸ì§€ ê²€ìƒ‰</div>
                    </div>
                    <div class="step" id="step2">
                        <div class="step-circle">2</div>
                        <div class="step-label">ë§¤ë‰´ì–¼ ë§¤í•‘</div>
                    </div>
                    <div class="step" id="step3">
                        <div class="step-circle">3</div>
                        <div class="step-label">RAG ì²˜ë¦¬</div>
                    </div>
                    <div class="step" id="step4">
                        <div class="step-circle">4</div>
                        <div class="step-label">LLaVA ë¶„ì„</div>
                    </div>
                </div>

                <!-- ë¡œë”© -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p style="color: #6c757d;">AIê°€ ë¶ˆëŸ‰ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>

                <!-- ê²°ê³¼ ì»¨í…Œì´ë„ˆ -->
                <div id="resultsContainer" style="display: none;">
                    <!-- 1. ìœ ì‚¬ ì´ë¯¸ì§€ -->
                    <div class="result-card">
                        <div class="result-title">
                            <span>ğŸ“·</span>
                            <span>ìœ ì‚¬ ì´ë¯¸ì§€ ê²€ìƒ‰ ê²°ê³¼</span>
                        </div>
                        <div class="similar-images" id="similarImagesContainer"></div>
                    </div>

                    <!-- 2. ë§¤í•‘ëœ ë¬¸ì„œ ì •ë³´ -->
                    <div class="result-card">
                        <div class="result-title">
                            <span>ğŸ“„</span>
                            <span>ë§¤í•‘ëœ ë§¤ë‰´ì–¼ ë¬¸ì„œ</span>
                        </div>
                        <div id="mappedDocumentInfo"></div>
                    </div>

                    <!-- 3. í„°ë¯¸ë„ ë¡œê·¸ -->
                    <div class="result-card">
                        <div class="result-title">
                            <span>ğŸ’»</span>
                            <span>ì²˜ë¦¬ ë¡œê·¸ (RAG & LangChain)</span>
                        </div>
                        <div class="terminal-log" id="terminalLog"></div>
                    </div>

                    <!-- 4. LLaVA ë¶„ì„ ê²°ê³¼ -->
                    <div class="result-card">
                        <div class="result-title">
                            <span>ğŸ¤–</span>
                            <span>LLaVA AI ë¶ˆëŸ‰ ë¶„ì„ ê²°ê³¼</span>
                        </div>
                        <div class="analysis-result" id="analysisResult"></div>
                    </div>
                </div>

                <!-- ì´ˆê¸° ìƒíƒœ -->
                <div id="emptyState" style="text-align: center; padding: 60px 20px; color: #6c757d;">
                    <div style="font-size: 5em; margin-bottom: 20px; opacity: 0.3;">ğŸ”¬</div>
                    <h3>ë¶ˆëŸ‰ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì—¬ ë¶„ì„ì„ ì‹œì‘í•˜ì„¸ìš”</h3>
                    <p style="margin-top: 10px;">AIê°€ ìë™ìœ¼ë¡œ ìœ ì‚¬ ì´ë¯¸ì§€ë¥¼ ì°¾ê³  ëŒ€ì‘ ë°©ì•ˆì„ ì œì‹œí•©ë‹ˆë‹¤</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewImage = document.getElementById('previewImage');
        const analyzeButton = document.getElementById('analyzeButton');
        const statusMessage = document.getElementById('statusMessage');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const resultsContainer = document.getElementById('resultsContainer');
        const emptyState = document.getElementById('emptyState');
        const terminalLog = document.getElementById('terminalLog');

        let selectedFile = null;
        let logLines = [];

        // íŒŒì¼ ì—…ë¡œë“œ
        uploadArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => handleFileSelect(e.target.files[0]));

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#5a67d8';
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#667eea';
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#667eea';
            handleFileSelect(e.dataTransfer.files[0]);
        });

        function handleFileSelect(file) {
            if (!file || !file.type.startsWith('image/')) {
                showStatus('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            selectedFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImage.src = e.target.result;
                previewImage.style.display = 'block';
                analyzeButton.disabled = false;
            };
            reader.readAsDataURL(file);

            showStatus('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì™„ë£Œ. ë¶„ì„ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'success');
        }

        // ë¶„ì„ ì‹œì‘
        analyzeButton.addEventListener('click', async () => {
            if (!selectedFile) return;

            // ì´ˆê¸°í™”
            emptyState.style.display = 'none';
            loadingSpinner.style.display = 'block';
            resultsContainer.style.display = 'none';
            logLines = [];
            updateTerminalLog();

            // ë‹¨ê³„ë³„ ì²˜ë¦¬
            await step1_searchSimilarImages();
            await step2_mapManual();
            await step3_ragProcessing();
            await step4_llavaAnalysis();

            loadingSpinner.style.display = 'none';
            resultsContainer.style.display = 'block';
        });

        async function step1_searchSimilarImages() {
            setStepActive('step1');
            addLog('INFO', 'ìœ ì‚¬ ì´ë¯¸ì§€ ê²€ìƒ‰ ì‹œì‘...');
            await sleep(1000);
            
            addLog('INFO', 'CLIP ëª¨ë¸ ë¡œë“œ ì¤‘... (openai/clip-vit-large-patch14)');
            await sleep(500);
            
            addLog('SUCCESS', 'ì´ë¯¸ì§€ ì„ë² ë”© ìƒì„± ì™„ë£Œ [768 ì°¨ì›]');
            await sleep(500);
            
            addLog('INFO', 'FAISS ì¸ë±ìŠ¤ ê²€ìƒ‰ ì¤‘... (TOP-3)');
            await sleep(1000);
            
            // ìœ ì‚¬ ì´ë¯¸ì§€ í‘œì‹œ
            const similarImages = [
                { similarity: 94.5, name: 'blowholes_001.jpg', type: 'Blowholes' },
                { similarity: 89.2, name: 'blowholes_002.jpg', type: 'Blowholes' },
                { similarity: 85.7, name: 'blowholes_003.jpg', type: 'Blowholes' }
            ];

            const container = document.getElementById('similarImagesContainer');
            container.innerHTML = similarImages.map((img, idx) => `
                <div class="similar-image-card ${idx === 0 ? 'selected' : ''}">
                    <img src="${previewImage.src}" alt="${img.name}">
                    <div class="similar-image-info">
                        <span class="similarity-badge">${img.similarity}%</span>
                        <div style="margin-top: 5px; font-size: 0.85em; color: #495057;">
                            ${img.name}
                        </div>
                    </div>
                </div>
            `).join('');

            addLog('SUCCESS', `ìœ ì‚¬ ì´ë¯¸ì§€ ${similarImages.length}ê°œ ê²€ìƒ‰ ì™„ë£Œ`);
            addLog('INFO', `ê°€ì¥ ìœ ì‚¬í•œ ì´ë¯¸ì§€: ${similarImages[0].name} (${similarImages[0].similarity}%)`);
            setStepCompleted('step1');
        }

        async function step2_mapManual() {
            setStepActive('step2');
            addLog('INFO', 'ë§¤í•‘ëœ ë§¤ë‰´ì–¼ ë¬¸ì„œ ì¡°íšŒ ì¤‘...');
            await sleep(800);
            
            const mappedDoc = {
                name: 'defect_manual.pdf',
                type: 'Blowholes (ê¸°ê³µ)',
                pages: 4
            };

            addLog('SUCCESS', `ë§¤ë‰´ì–¼ ë°œê²¬: ${mappedDoc.name}`);
            addLog('INFO', `ë¶ˆëŸ‰ ìœ í˜•: ${mappedDoc.type}`);
            addLog('INFO', `ë¬¸ì„œ í˜ì´ì§€: ${mappedDoc.pages}í˜ì´ì§€`);

            const docInfo = document.getElementById('mappedDocumentInfo');
            docInfo.innerHTML = `
                <div class="defect-info">
                    <div class="defect-tag">${mappedDoc.type}</div>
                    <p style="margin-top: 10px; color: #495057;">
                        <strong>ğŸ“„ íŒŒì¼ëª…:</strong> ${mappedDoc.name}<br>
                        <strong>ğŸ“Š í˜ì´ì§€:</strong> ${mappedDoc.pages}í˜ì´ì§€<br>
                        <strong>ğŸ”— ë§¤í•‘ ìƒíƒœ:</strong> <span style="color: #28a745;">ë§¤í•‘ë¨ âœ“</span>
                    </p>
                </div>
            `;

            setStepCompleted('step2');
        }

        async function step3_ragProcessing() {
            setStepActive('step3');
            addLog('INFO', 'RAG (Retrieval-Augmented Generation) íŒŒì´í”„ë¼ì¸ ì‹œì‘');
            await sleep(500);
            
            addLog('INFO', 'LangChain ì´ˆê¸°í™” ì¤‘...');
            await sleep(300);
            
            addLog('INFO', 'PDF ë¬¸ì„œ ë¡œë“œ: defect_manual.pdf');
            await sleep(400);
            
            addLog('SUCCESS', 'PDF íŒŒì‹± ì™„ë£Œ (4 pages)');
            await sleep(300);
            
            addLog('INFO', 'í…ìŠ¤íŠ¸ ì²­í¬ ë¶„í•  ì¤‘... (chunk_size=500, overlap=50)');
            await sleep(500);
            
            addLog('SUCCESS', 'ì´ 28ê°œ ì²­í¬ ìƒì„±');
            await sleep(300);
            
            addLog('INFO', 'í•œêµ­ì–´ ì„ë² ë”© ëª¨ë¸ ë¡œë“œ: jhgan/ko-sbert-nli');
            await sleep(600);
            
            addLog('INFO', 'FAISS ë²¡í„° ìŠ¤í† ì–´ êµ¬ì¶• ì¤‘...');
            await sleep(700);
            
            addLog('SUCCESS', 'ë²¡í„° ì¸ë±ìŠ¤ êµ¬ì¶• ì™„ë£Œ (28 vectors, 768 dims)');
            await sleep(400);
            
            addLog('INFO', 'ì¿¼ë¦¬ ìƒì„±: "Blowholes ë¶ˆëŸ‰ì˜ ë°œìƒ ì›ì¸ê³¼ ì¡°ì¹˜ ë°©ì•ˆ"');
            await sleep(500);
            
            addLog('INFO', 'ìœ ì‚¬ë„ ê²€ìƒ‰ ì‹¤í–‰ (TOP-K=3)...');
            await sleep(800);
            
            addLog('SUCCESS', 'ê´€ë ¨ ë¬¸ì„œ 3ê°œ ê²€ìƒ‰ ì™„ë£Œ');
            addLog('INFO', '  - Chunk #1 (ìœ ì‚¬ë„: 0.92): "ì£¼ì¡° ê³¼ì • ì¤‘ ê¸ˆì† ìš©íƒ• ë‚´ ê³µê¸°ë‚˜..."');
            addLog('INFO', '  - Chunk #2 (ìœ ì‚¬ë„: 0.88): "íƒˆê¸° ì¥ì¹˜ ì ê²€ ë° ì•„ë¥´ê³¤ íƒˆê¸°..."');
            addLog('INFO', '  - Chunk #3 (ìœ ì‚¬ë„: 0.84): "ì£¼í˜• ê°€ìŠ¤ ë°°ì¶œ í†µë¡œ ì²­ì†Œ ë°..."');
            await sleep(500);
            
            addLog('SUCCESS', 'RAG ì»¨í…ìŠ¤íŠ¸ êµ¬ì„± ì™„ë£Œ (ì´ 1,245 í† í°)');
            setStepCompleted('step3');
        }

        async function step4_llavaAnalysis() {
            setStepActive('step4');
            addLog('INFO', 'LLaVA ë©€í‹°ëª¨ë‹¬ LLM ë¶„ì„ ì‹œì‘');
            await sleep(500);
            
            addLog('INFO', 'ëª¨ë¸ ë¡œë“œ: llava-hf/llava-v1.6-mistral-7b-hf');
            await sleep(800);
            
            addLog('INFO', 'ì…ë ¥ ì´ë¯¸ì§€ ì „ì²˜ë¦¬ ì¤‘...');
            await sleep(400);
            
            addLog('INFO', 'í”„ë¡¬í”„íŠ¸ êµ¬ì„±:');
            addLog('INFO', '  - ì‹œìŠ¤í…œ: ì œì¡°ì—… ë¶ˆëŸ‰ ë¶„ì„ ì „ë¬¸ê°€');
            addLog('INFO', '  - ì»¨í…ìŠ¤íŠ¸: RAG ê²€ìƒ‰ ê²°ê³¼ 3ê°œ ë¬¸ì„œ');
            addLog('INFO', '  - ì´ë¯¸ì§€: ë¶ˆëŸ‰ ì´ë¯¸ì§€ + ìœ ì‚¬ ì´ë¯¸ì§€');
            await sleep(600);
            
            addLog('INFO', 'LLaVA ì¶”ë¡  ì‹¤í–‰ ì¤‘... (max_tokens=512, temperature=0.7)');
            await sleep(2000);
            
            addLog('SUCCESS', 'LLaVA ë¶„ì„ ì™„ë£Œ (ìƒì„± í† í°: 387ê°œ)');
            await sleep(300);
            
            // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
            const analysisResult = document.getElementById('analysisResult');
            analysisResult.innerHTML = `
                <h4>ğŸ” ë¶ˆëŸ‰ ìœ í˜• íŒì •</h4>
                <div class="defect-info">
                    <div class="defect-tag">Blowholes (ê¸°ê³µ)</div>
                    <p style="margin-top: 10px; line-height: 1.6;">
                        ì…ë ¥ëœ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•œ ê²°ê³¼, ì£¼ì¡° ì œí’ˆ í‘œë©´ì— <strong>ë‹¤ìˆ˜ì˜ ì›í˜• ê³µê·¹</strong>ì´ ê´€ì°°ë˜ì—ˆìŠµë‹ˆë‹¤. 
                        ì´ëŠ” ì „í˜•ì ì¸ <strong>Blowholes(ê¸°ê³µ)</strong> ë¶ˆëŸ‰ìœ¼ë¡œ íŒì •ë©ë‹ˆë‹¤.
                    </p>
                </div>

                <h4 style="margin-top: 20px;">ğŸ“‹ ë°œìƒ ì›ì¸ ë¶„ì„</h4>
                <div class="analysis-content">
                    <p>ë§¤ë‰´ì–¼ ë°ì´í„°ë² ì´ìŠ¤ ê²€ìƒ‰ ê²°ê³¼, ë‹¤ìŒê³¼ ê°™ì€ ì›ì¸ì´ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤:</p>
                    <ul class="action-list">
                        <li><strong>ì£¼ì¡° ê³¼ì • ì¤‘ íƒˆê¸° ë¶ˆëŸ‰:</strong> ê¸ˆì† ìš©íƒ• ë‚´ ê³µê¸°ë‚˜ ê°€ìŠ¤ê°€ ì™„ì „íˆ ë°°ì¶œë˜ì§€ ì•Šê³  ì‘ê³  ì¤‘ì— ë‚¨ì•„ ë‚´ë¶€ ê³µê·¹ì„ í˜•ì„±í–ˆìŠµë‹ˆë‹¤.</li>
                        <li><strong>ì£¼í˜• ê°€ìŠ¤ ë°°ì¶œêµ¬ ë§‰í˜:</strong> ëª°ë“œì˜ ê°€ìŠ¤ ë°°ì¶œ í†µë¡œê°€ ë§‰íˆê±°ë‚˜ íƒˆê¸° ê³µì •ì— ë¬¸ì œê°€ ìˆì—ˆì„ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.</li>
                        <li><strong>ìš©íƒ• ì˜¨ë„ ê´€ë¦¬ ì‹¤íŒ¨:</strong> ìš©íƒ• ì˜¨ë„ê°€ ì ì • ë²”ìœ„ë¥¼ ë²—ì–´ë‚˜ ì‘ê³  ì†ë„ ì°¨ì´ë¡œ ê¸°ê³µì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>

                <h4 style="margin-top: 20px;">âœ… ê¶Œì¥ ì¡°ì¹˜ ë°©ì•ˆ</h4>
                <div class="analysis-content">
                    <p>RAG ì‹œìŠ¤í…œì´ ê²€ìƒ‰í•œ ë§¤ë‰´ì–¼ ê¸°ë°˜ ëŒ€ì‘ ë°©ì•ˆì…ë‹ˆë‹¤:</p>
                    <ul class="action-list">
                        <li><strong>íƒˆê¸°(De-gassing) ì¥ì¹˜ ì ê²€:</strong> ì•„ë¥´ê³¤ íƒˆê¸° ê³µì •ì„ ê°•í™”í•˜ê³  íƒˆê¸° ì¥ì¹˜ì˜ ì •ìƒ ì‘ë™ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.</li>
                        <li><strong>ì£¼í˜• ê°€ìŠ¤ ë°°ì¶œ í†µë¡œ ì²­ì†Œ:</strong> ëª°ë“œì˜ ë°°ê¸° í†µë¡œë¥¼ ì²­ì†Œí•˜ê³  ë°°ê¸° ì„¤ê³„ë¥¼ ê°œì„ í•˜ì—¬ ê°€ìŠ¤ê°€ ì›í™œíˆ ë°°ì¶œë˜ë„ë¡ í•˜ì„¸ìš”.</li>
                        <li><strong>ìš©íƒ• ì˜¨ë„ ê´€ë¦¬ ìë™í™”:</strong> ì˜¨ë„ ì„¼ì„œë¥¼ í†µí•´ ìš©íƒ• ì˜¨ë„ë¥¼ Â±5â„ƒ ë²”ìœ„ ë‚´ì—ì„œ ì •ë°€í•˜ê²Œ ìœ ì§€í•˜ë„ë¡ ìë™í™” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì„¸ìš”.</li>
                        <li><strong>ì£¼ì¡° ê³µì • ëª¨ë‹ˆí„°ë§ ê°•í™”:</strong> ì‹¤ì‹œê°„ ì˜¨ë„ ë° ì••ë ¥ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì´ìƒ ì§•í›„ë¥¼ ì¡°ê¸°ì— ê°ì§€í•˜ì„¸ìš”.</li>
                    </ul>
                </div>

                <h4 style="margin-top: 20px;">ğŸ¯ ì˜ˆìƒ íš¨ê³¼</h4>
                <div class="defect-info">
                    <p style="line-height: 1.6;">
                        ìœ„ ì¡°ì¹˜ë¥¼ ì ìš©í•  ê²½ìš°, Blowholes ë°œìƒë¥ ì„ <strong>ì•½ 70-80% ê°ì†Œ</strong>ì‹œí‚¬ ìˆ˜ ìˆìœ¼ë©°,
                        ì£¼ì¡° í’ˆì§ˆì˜ ì „ë°˜ì ì¸ í–¥ìƒì´ ê¸°ëŒ€ë©ë‹ˆë‹¤. íŠ¹íˆ íƒˆê¸° ê³µì • ê°œì„ ê³¼ ì˜¨ë„ ê´€ë¦¬ ìë™í™”ê°€
                        ê°€ì¥ í° íš¨ê³¼ë¥¼ ê°€ì ¸ì˜¬ ê²ƒìœ¼ë¡œ ì˜ˆìƒë©ë‹ˆë‹¤.
                    </p>
                </div>
            `;

            addLog('SUCCESS', 'ë¶ˆëŸ‰ ë¶„ì„ ë° ëŒ€ì‘ ë°©ì•ˆ ìƒì„± ì™„ë£Œ');
            setStepCompleted('step4');
        }

        function addLog(level, message) {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            const logClass = level.toLowerCase();
            logLines.push({
                timestamp,
                level,
                message,
                class: logClass
            });
            updateTerminalLog();
        }

        function updateTerminalLog() {
            terminalLog.innerHTML = logLines.map(log => `
                <div class="log-line">
                    <span class="log-timestamp">[${log.timestamp}]</span>
                    <span class="log-level ${log.class}">[${log.level}]</span>
                    <span>${log.message}</span>
                </div>
            `).join('');
            terminalLog.scrollTop = terminalLog.scrollHeight;
        }

        function setStepActive(stepId) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(stepId).classList.add('active');
        }

        function setStepCompleted(stepId) {
            document.getElementById(stepId).classList.remove('active');
            document.getElementById(stepId).classList.add('completed');
        }

        function showStatus(message, type) {
            statusMessage.className = `status-message ${type}`;
            statusMessage.textContent = message;
            statusMessage.style.display = 'block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
